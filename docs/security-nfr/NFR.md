# NFR.md — Требования безопасности

| ID     | Название                   | Описание                                                                       | Метрика/Порог                       | Проверка (чем/где)                   | Компонент  | Приоритет |
|--------|----------------------------|--------------------------------------------------------------------------------|-------------------------------------|--------------------------------------|------------|-----------|
| NFR-01 | Хранение паролей           | Пароли хэшируются перед сохранением                                            | bcrypt с cost ≥ 12                  | Unit-тест на `hash_password`          | Auth       | High      |
| NFR-02 | Длина пароля               | Минимальная длина пароля                                                       | ≥ 6 символов                        | Pydantic валидация (`RegisterIn`)     | Auth       | High      |
| NFR-03 | Срок жизни Access/Refresh  | Ограниченный TTL токенов                                                       | Access ≤ 5 мин; Refresh ≤ 30 мин    | Проверка через `settings` + e2e-тест  | Tokens     | High      |
| NFR-04 | Ротация Refresh            | Refresh-токен может быть использован только один раз                           | Старый refresh всегда revoked        | Интеграционный тест `refresh_token`   | Tokens     | High      |
| NFR-05 | Авторизация по ролям       | Ограничение доступа к ресурсам по ролям                                        | user — только свои, admin — все     | E2E тесты `entries`                   | Entries    | High      |
| NFR-06 | Ошибки аутентификации      | Унифицированные ответы об ошибках                                              | 100% ошибок → 401/403                | Контракт-тесты API                    | API        | Medium    |
| NFR-07 | Защита секретов            | JWT-секрет и конфигурация в `.env`, а не в коде                                | Нет секретов в репозитории           | Code review + CI проверка             | Platform   | High      |
| NFR-08 | Приватность данных         | Храним минимальный набор полей                                                 | Email, пароль (bcrypt), роль, active | Инспекция моделей                     | Models     | Medium    |
| NFR-09 | Transport Security         | Весь трафик проходит только по HTTPS                                           | TLS ≥ 1.2                            | Проверка при деплое                   | Platform   | High      |
