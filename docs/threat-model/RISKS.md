# RISKS — Реестр рисков

**Шкала приоритета:** High — Risk ≥ 12; Medium — 8–11; Low — ≤ 7.

| RiskID | Описание                                                                 | Связь (F/NFR)            | L | I | Risk | Стратегия          | Владелец   | Срок        | Критерий                                                                                 |
|--------|---------------------------------------------------------------------------|--------------------------|---|---|------|--------------------|------------|-------------|----------------------------------------------------------------------------------------------------|
| R1     | Брутфорс логина / подбор пароля                                          | F2, NFR-06               | 3 | 4 | 12   | Снизить            | @backend   | 2025-09-07  | Rate-limit на `/auth/login` (пер-IP/пер-device); негативные тесты на частые попытки → 401/429     |
| R2     | Reuse/подмена refresh-токена (replay)                                    | F4/F7/F7b, NFR-04        | 3 | 5 | 15   | Снизить (Quick Win)| @backend   | 2025-09-10  | Тесты: `revoke_refresh_by_jti`/`revoke_refresh_for_device` проходят; запись `revoked=True`         |
| R3     | Утечка секретов (JWT_SECRET/ISSUER) в репозитории/логах                  | F9, NFR-07               | 2 | 5 | 10   | Снизить            | @devops    | 2025-10-25  | Включён `detect-secrets`/`dotenv-linter` в pre-commit/CI; нет секретов в diff/истории              |
| R4     | Несанкционированный доступ к чужим записям (IDOR)                        | F5/F6, NFR-05/NFR-08     | 3 | 4 | 12   | Снизить            | @backend   | 2025-09-05  | Тесты: пользователь не видит/не меняет чужие `entries` → 403/404; проверка `owner_id` на всех CRUD |
| R5     | Избыточные сообщения об ошибках (утечка причин)                          | F2, NFR-06               | 2 | 4 | 8    | Снизить            | @backend   | 2025-09-28  | Контракт-тесты: все auth-ошибки унифицированы (401/403), без деталей пользователя/политик          |
| R6     | Нет TLS на периметре (MITM/сниффинг)                                     | F1/F2/F5/F10, NFR-09     | 2 | 5 | 10   | Снизить            | @devops    | 2025-10-15  | Деплой за HTTPS (TLS ≥1.2); проверка `curl -v` и security-headers; CI чек на prod URL              |
| R7     | DoS/перегрузка `/entries` (чрезмерные запросы/ответы)                    | F5, NFR-09               | 3 | 3 | 9    | Снизить            | @backend   | 2025-09-30  | Пагинация и `limit ≤ 200` применяются; нагрузочный тест: стаб. p95 и отсутствие 5xx                 |
| R8     | Массовая регистрация ботов/фейков                                        | F1, NFR-01               | 3 | 3 | 9    | Снизить            | @backend   | 2025-09-08  | Rate-limit на `/auth/register`; валидация email; негативные тесты на быстрые повторные регистрации |
| R9     | Недостаточная стойкость хранения паролей                                  | F3, NFR-01               | 2 | 5 | 10   | Снизить (Quick Win)| @backend   | 2025-09-20  | Юнит-тесты подтверждают bcrypt с cost ≥12; пароль не хранится в открытом виде                      |
| R10    | Доступ к `/admin` без нужной роли (эскалация привилегий)                 | F10, NFR-05              | 2 | 5 | 10   | Снизить            | @backend   | 2025-09-08  | Тесты: non-admin получает 403 на `/api/v1/admin`; проверка роли в dependency                       |
| R11    | Неполный logout: не добавлен access/refresh в blacklist, device не отозван| F8/F8b, NFR-04           | 2 | 4 | 8    | Снизить            | @backend   | 2025-09-27  | Тест `logout`: refresh помечен `revoked`, в `revoked_tokens` есть записи для access/refresh         |
| R12    | Избыточные/чувствительные поля в моделях и ответах API                   | F6, NFR-08               | 2 | 4 | 8    | Снизить            | @backend   | 2025-09-27  | Ревью схем: в ответах только нужные поля; контракт-тесты и snapshot-проверки JSON                   |
