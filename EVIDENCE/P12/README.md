# P12 - IaC & Container Security Evidence

This directory contains security scanning reports for Infrastructure as Code (IaC) and container security as part of P12 practice.

## Reports

### 1. Hadolint Report (`hadolint_report.json`)
- **Tool**: Hadolint
- **Target**: `Dockerfile`
- **Purpose**: Dockerfile best practices and linting
- **Format**: JSON

Checks for:
- Best practices violations
- Security issues in Dockerfile
- Optimization opportunities
- Deprecated instructions

### 2. Checkov Report (`checkov_report.json`)
- **Tool**: Checkov by Bridgecrew
- **Target**: IaC files (K8s manifests, docker-compose.yml)
- **Purpose**: Infrastructure as Code security scanning
- **Format**: JSON

Checks for:
- Kubernetes security misconfigurations
- Docker Compose security issues
- Missing security contexts
- Privilege escalation risks
- Resource limit violations

### 3. Trivy Report (`trivy_report.json`)
- **Tool**: Trivy by Aqua Security
- **Target**: Container image `reading-list-api:local`
- **Purpose**: Vulnerability scanning
- **Format**: JSON

Scans for:
- OS package vulnerabilities
- Application dependency vulnerabilities
- Configuration issues
- Secrets in image layers

### 4. Hardening Summary (`hardening_summary.md`)
- Summary of applied security hardening measures
- List of tools used
- Key findings and recommendations
- Next steps for improvement

## How to Generate Reports

### Locally

```bash
# Run Hadolint
docker run --rm -i -v $PWD:/work hadolint/hadolint:latest \
  hadolint -f json /work/Dockerfile > EVIDENCE/P12/hadolint_report.json

# Run Checkov
docker run --rm -v $PWD:/work bridgecrew/checkov:latest \
  --directory /work \
  --framework kubernetes dockerfile docker_compose \
  --output json \
  --compact

# Build image first
docker build -t reading-list-api:local .

# Run Trivy
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
  -v $PWD:/work aquasec/trivy:latest \
  image reading-list-api:local \
    --format json \
    --output /work/EVIDENCE/P12/trivy_report.json
```

### In CI/CD

Reports are automatically generated by the GitHub Actions workflow:
- `.github/workflows/ci-p12-iac-container.yml`

The workflow runs on:
- Manual trigger (`workflow_dispatch`)
- Push to relevant files (Dockerfile, k8s/*, docker-compose.yml, etc.)
- Pull requests

## Hardening Measures Applied

### Dockerfile
- ✅ Multi-stage build
- ✅ Specific base image version (no `latest`)
- ✅ Non-root user (appuser, UID 1000)
- ✅ Minimal runtime dependencies
- ✅ Health check configured
- ✅ No secrets in image

### Docker Compose
- ✅ Specific versions for all images
- ✅ Security options: `no-new-privileges:true`
- ✅ Capability dropping: `cap_drop: [ALL]`
- ✅ Read-only filesystem where applicable
- ✅ Network isolation (internal networks)
- ✅ Resource limits
- ✅ Health checks

### Kubernetes
- ✅ SecurityContext with `runAsNonRoot: true`
- ✅ `readOnlyRootFilesystem: true`
- ✅ `allowPrivilegeEscalation: false`
- ✅ All capabilities dropped
- ✅ Seccomp profile: RuntimeDefault
- ✅ Resource requests and limits
- ✅ Liveness and readiness probes
- ✅ Secrets managed externally

## Security Standards Compliance

These scans help ensure compliance with:
- CIS Docker Benchmark
- CIS Kubernetes Benchmark
- OWASP Container Security
- NSA/CISA Kubernetes Hardening Guidance

## Next Steps

1. Review CRITICAL and HIGH severity findings
2. Update base images to latest secure versions
3. Implement Kubernetes NetworkPolicies
4. Set up automated secret rotation
5. Configure runtime security monitoring
6. Enable Pod Security Standards/Admission

## References

- [Hadolint Rules](https://github.com/hadolint/hadolint)
- [Checkov Policies](https://www.checkov.io/5.Policy%20Index/kubernetes.html)
- [Trivy Documentation](https://aquasecurity.github.io/trivy/)
- [CIS Docker Benchmark](https://www.cisecurity.org/benchmark/docker)
- [CIS Kubernetes Benchmark](https://www.cisecurity.org/benchmark/kubernetes)
